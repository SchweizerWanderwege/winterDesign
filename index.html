<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="resources/ol.css">
        <link rel="stylesheet" href="resources/fontawesome-all.min.css">
        <link href="resources/photon-geocoder-autocomplete.min.css" rel="stylesheet">
        <link rel="stylesheet" href="resources/ol-layerswitcher.css">
        <link rel="stylesheet" href="resources/qgis2web.css">
        <style>
        html, body {
            background-color: #ffffff;
        }
        .ol-control > * {
            background-color: #f8f8f8!important;
            color: #444444!important;
            border-radius: 0px;
        }
        .ol-attribution a, .gcd-gl-input::placeholder, .search-layer-input-search::placeholder {
            color: #444444!important;
        }
        .search-layer-input-search {
            background-color: #f8f8f8!important;
        }
        .ol-control > *:focus, .ol-control >*:hover {
            background-color: rgba(248, 248, 248, 0.7)!important;
        } 
        .ol-control {
            background-color: rgba(255,255,255,.4) !important;
            padding: 2px !important;
        } 
        </style>

        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        </style>
        <title></title>
    </head>
    <body>
        <div id="controls" style="position:absolute; top:10px; left:10px; background:white; padding:10px; border-radius:6px; z-index:1000; max-width:550px;">
          
        <h4>Winterwanderwege</h4>
        <label for="colorWinter">Aussenfarbe:</label>
        <input type="color" id="colorWinter" value="#ff84ff"><br>
        
        <label for="colorWinterInner">Innenfarbe:</label>
        <input type="color" id="colorWinterInner" value="#e044c2"><br>
        
        <label for="opacityWinter">Transparenz:</label>
        <input type="range" id="opacityWinter" min="0" max="1" step="0.05" value="0.7">
        <input type="number" id="opacityValueWinter" min="0" max="1" step="0.05" value="0.7" style="width:100px;"><br>
        
        <!-- 3-column layout -->
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-top:10px;">
          <!-- Class 1 -->
          <div>
            <h5>Resolution 1-5 </h5>
            <label>Innenlinie Best-of (px):</label>
            <input type="number" id="ww_innerCHM1_class1" value="5" step="0.1"><br>
            <label>Aussenlinie Best-of (px):</label>
            <input type="number" id="ww_outerCHM1_class1" value="14" step="0.1"><br>
            <label>Innenlinie Basisnetz (px):</label>
            <input type="number" id="ww_innerCHM0_class1" value="5" step="0.1"><br>
            <label>Aussenlinie Basisnetz (px):</label>
            <input type="number" id="ww_outerCHM0_class1" value="5" step="0.1"><br>
          </div>
        
          <!-- Class 2 -->
          <div>
            <h5>Resolution 5-20 </h5>
            <label>Innenlinie Best-of (px):</label>
            <input type="number" id="ww_innerCHM1_class2" value="4" step="0.1"><br>
            <label>Aussenlinie Best-of (px):</label>
            <input type="number" id="ww_outerCHM1_class2" value="8" step="0.1"><br>
            <label>Innenlinie Basisnetz (px):</label>
            <input type="number" id="ww_innerCHM0_class2" value="4" step="0.1"><br>
            <label>Aussenlinie Basisnetz (px):</label>
            <input type="number" id="ww_outerCHM0_class2" value="4" step="0.1"><br>
          </div>
        
          <!-- Class 3 -->
          <div>
            <h5>Resolution 20+</h5>
            <label>Innenlinie Best-of (px):</label>
            <input type="number" id="ww_innerCHM1_class3" value="4.00" step="0.1"><br>
            <label>Aussenlinie Best-of (px):</label>
            <input type="number" id="ww_outerCHM1_class3" value="0.00" step="0.1"><br>
            <label>Innenlinie Basisnetz (px):</label>
            <input type="number" id="ww_innerCHM0_class3" value="2.00" step="0.1"><br>
            <label>Aussenlinie Basisnetz (px):</label>
            <input type="number" id="ww_outerCHM0_class3" value="0.00" step="0.1"><br>
          </div>
        </div>

        <hr>

          <h4>Kantone Winterwanderwege</h4>
          <label for="colorPicker4">Farbe:</label>
          <input type="color" id="colorPicker4" value="#ffb8ff"><br>
          <!--<label for="opacitySlider4">Transparenz:</label>
          <input type="range" id="opacitySlider4" min="0" max="1" step="0.1" value="0.7">
          <input type="number" id="opacityValue4" min="0" max="1" step="0.05" value="0.7" style="width:60px;"> -->

          <hr>

        <h4>Schneeschuhwanderwege</h4>
        <label for="colorSchnee">Aussenfarbe:</label>
        <input type="color" id="colorSchnee" value="#ba498f"><br>
        
        <label for="colorSchneeInner">Innenfarbe:</label>
        <input type="color" id="colorSchneeInner" value="#8c0a50"><br>
        
        <label for="opacitySchnee">Transparenz:</label>
        <input type="range" id="opacitySchnee" min="0" max="1" step="0.05" value="0.7">
        <input type="number" id="opacityValueSchnee" min="0" max="1" step="0.05" value="0.7" style="width:60px;"><br>
        
        <!-- 3-column layout -->
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-top:10px;">
          <!-- Class 1 -->
          <div>
            <h5>Resolution 1-5 </h5>
            <label>Innenlinie Best-of (px):</label>
            <input type="number" id="schnee_innerCHM1_class1" value="5" step="0.1"><br>
            <label>Aussenlinie Best-of (px):</label>
            <input type="number" id="schnee_outerCHM1_class1" value="14" step="0.1"><br>
            <label>Innenlinie Basisnetz (px):</label>
            <input type="number" id="schnee_innerCHM0_class1" value="5" step="0.1"><br>
            <label>Aussenlinie Basisnetz (px):</label>
            <input type="number" id="schnee_outerCHM0_class1" value="5" step="0.1"><br>
          </div>
        
          <!-- Class 2 -->
          <div>
            <h5>Resolution 5-20</h5>
            <label>Innenlinie Best-of (px):</label>
            <input type="number" id="schnee_innerCHM1_class2" value="4" step="0.1"><br>
            <label>Aussenlinie Best-of (px):</label>
            <input type="number" id="schnee_outerCHM1_class2" value="8" step="0.1"><br>
            <label>Innenlinie Basisnetz (px):</label>
            <input type="number" id="schnee_innerCHM0_class2" value="4" step="0.1"><br>
            <label>Aussenlinie Basisnetz (px):</label>
            <input type="number" id="schnee_outerCHM0_class2" value="4" step="0.1"><br>
          </div>
        
          <!-- Class 3 -->
          <div>
            <h5>Resolution 20+</h5>
            <label>Innenlinie Best-of (px):</label>
            <input type="number" id="schnee_innerCHM1_class3" value="4" step="0.1"><br>
            <label>Aussenlinie Best-of (px):</label>
            <input type="number" id="schnee_outerCHM1_class3" value="0.00" step="0.1"><br>
            <label>Innenlinie Basisnetz (px):</label>
            <input type="number" id="schnee_innerCHM0_class3" value="2" step="0.1"><br>
            <label>Aussenlinie Basisnetz (px):</label>
            <input type="number" id="schnee_outerCHM0_class3" value="0.00" step="0.1"><br>
          </div>
        </div>

        <hr>          

          <h4>Kantone Schneeschuhwanderwege</h4>
          <label for="colorPicker2">Farbe:</label>
          <input type="color" id="colorPicker2" value="#ba498f"><br>
          <!--<label for="opacitySlider2">Transparenz:</label>
          <input type="range" id="opacitySlider2" min="0" max="1" step="0.1" value="0.7">
          <input type="number" id="opacityValue2" min="0" max="1" step="0.05" value="0.7" style="width:60px;"> -->
          
          <hr>

        </div>

        <div id="mapInfo" style="position:absolute; bottom:10px; left:10px; background:white; padding:5px 8px; border-radius:5px; font-family:sans-serif; font-size:12px; z-index:1000;">
            Zoom: <span id="zoomLevel"></span>, Scale: <span id="mapScale"></span>, Resolution: <span id="mapResolution"></span>
        </div>

        <div id="map">
            <div id="popup" class="ol-popup">
                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                <div id="popup-content"></div>
            </div>
        </div>
        <script src="resources/qgis2web_expressions.js"></script>
        <script src="resources/functions.js"></script>
        <script src="resources/ol.js"></script>
        <script src="resources/ol-layerswitcher.js"></script>
        <script src="resources/photon-geocoder-autocomplete.min.js"></script>
        <script src="layers/Datenstand_Kantone_2.js"></script><script src="layers/Schneeschuhwanderwege_3.js"></script><script src="layers/Datenstand_Kantone_4.js"></script><script src="layers/Winterwanderwege_5.js"></script>
        <script src="styles/Datenstand_Kantone_2_style.js"></script><script src="styles/Schneeschuhwanderwege_3_style.js"></script><script src="styles/Datenstand_Kantone_4_style.js"></script><script src="styles/Winterwanderwege_5_style.js"></script>
        <script src="layers/layers.js" type="text/javascript"></script> 
        <script src="resources/Autolinker.min.js"></script>
        <script src="resources/qgis2web.js"></script>
        <script>
          // Helper: Convert hex to RGB
          function hexToRgb(hex) {
            let bigint = parseInt(hex.slice(1), 16);
            let r = (bigint >> 16) & 255;
            let g = (bigint >> 8) & 255;
            let b = bigint & 255;
            return `${r}, ${g}, ${b}`;
          }

        function updateStyle(layer, color, opacity) {
          layer.setStyle(function(feature) {
            if (feature.get("ChmOnly") === 1) {
              // Hide feature completely
              return null;
            }
            // Normal style for visible features
            return new ol.style.Style({
              fill: new ol.style.Fill({
                color: `rgba(${hexToRgb(color)}, ${opacity})`
              }),
              stroke: new ol.style.Stroke({
                color: `rgba(${hexToRgb(color)}, ${opacity})`,
                width: 2
              })
            });
          });
        }

                // --- Layer: Datenstand_Kantone_2 ---
        function updateLayer2() {
          let color = document.getElementById('colorPicker2').value;
          let opacity = parseFloat(document.getElementById('opacitySchnee').value);
          document.getElementById('opacityValueSchnee').value = opacity; // sync to number box
          updateStyle(lyr_Datenstand_Kantone_2, color, opacity);
        }
        document.getElementById('colorPicker2').addEventListener('input', updateLayer2);
        document.getElementById('opacitySchnee').addEventListener('input', updateLayer2);
        document.getElementById('opacityValueSchnee').addEventListener('input', function(e) {
          let value = parseFloat(e.target.value);
          document.getElementById('opacitySchnee').value = value; // sync to slider
          updateLayer2();
        });
        updateLayer2(); // initial style


        // --- Layer: Datenstand_Kantone_4 ---
        function updateLayer4() {
          let color = document.getElementById('colorPicker4').value;
          let opacity = parseFloat(document.getElementById('opacityWinter').value);
          document.getElementById('opacityValueWinter').value = opacity; // sync to number box
          updateStyle(lyr_Datenstand_Kantone_4, color, opacity);
        }
        document.getElementById('colorPicker4').addEventListener('input', updateLayer4);
        document.getElementById('opacityWinter').addEventListener('input', updateLayer4);
        document.getElementById('opacityValueWinter').addEventListener('input', function(e) {
          let value = parseFloat(e.target.value);
          document.getElementById('opacityWinter').value = value; // sync to slider
          updateLayer4();
        });
        updateLayer4(); // initial style

        </script>
        <script>
            lyr_Winterwanderwege_5.setStyle(interactiveWinterStyle); // assign the interactive style

        function updateWinter() {
            // Sync numbers with sliders
            ["innerCHM1","outerCHM1","innerCHM0","outerCHM0"].forEach(id=>{
                document.getElementById(id+"Value").value = document.getElementById(id).value;
            });
            // Trigger redraw
            lyr_Winterwanderwege_5.changed();
        }

        // Add event listeners
        ["innerCHM1","outerCHM1","innerCHM0","outerCHM0"].forEach(id=>{
            document.getElementById(id).addEventListener('input', updateWinter);
        });
        ["innerCHM1Value","outerCHM1Value","innerCHM0Value","outerCHM0Value"].forEach(id=>{
            document.getElementById(id).addEventListener('input', function(e){
                let sliderId = id.replace("Value","");
                document.getElementById(sliderId).value = e.target.value;
                updateWinter();
            });
        });

        updateWinter();


        </script>
                <script>
            lyr_Schneeschuhwanderwege_3.setStyle(interactiveSchneeStyle); // assign the interactive style

        function updateSchnee() {
            // Sync numbers with sliders
            ["innerCHM1","outerCHM1","innerCHM0","outerCHM0"].forEach(id=>{
                document.getElementById(id+"Value").value = document.getElementById(id).value;
            });
            // Trigger redraw
            lyr_Schneeschuhwanderwege_3.changed();
        }

        // Add event listeners
        ["innerCHM1Schnee","outerCHM1Schnee","innerCHM0Schnee","outerCHM0Schnee"].forEach(id=>{
            document.getElementById(id).addEventListener('input', updateSchnee);
        });
        ["innerCHM1SchneeValue","outerCHM1SchneeValue","innerCHM0SchneeValue","outerCHM0SchneeValue"].forEach(id=>{
            document.getElementById(id).addEventListener('input', function(e){
                let sliderId = id.replace("Value","");
                document.getElementById(sliderId).value = e.target.value;
                updateSchnee();
            });
        });

        updateSchnee();


        </script>
        <script>
            function updateMapInfoSwiss() {
                const view = map.getView();
                const zoom = view.getZoom().toFixed(2);
                const resolution = view.getResolution(); // meters per pixel in projected units

                // Standard screen DPI
                const dpi = 96;

                // 1 inch = 0.0254 m
                const metersPerInch = 0.0254;

                // Scale denominator: map distance / screen distance
                // resolution is meters per pixel, dpi gives pixels per inch, so multiply
                const scale = (resolution * dpi / metersPerInch).toFixed(0);

                document.getElementById('zoomLevel').textContent = zoom;
                document.getElementById('mapScale').textContent = `1:${scale}`;
                document.getElementById('mapResolution').textContent = resolution.toFixed(2);
            }

            // Trigger on resolution change
            map.getView().on('change:resolution', updateMapInfoSwiss);
            updateMapInfoSwiss();
        </script>
    </body>
</html>









